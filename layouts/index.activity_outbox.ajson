{{- $pctx := . -}}
{{- if .IsHome -}}{{ $pctx = .Site }}{{- end -}}
{{- $pages := slice -}}
{{- if or $.IsHome $.IsSection -}}
{{- $pages = $pctx.RegularPages -}}
{{- else -}}
{{- $pages = $pctx.Pages -}}
{{- end -}}
{{- $limit := .Site.Config.Services.RSS.Limit -}}
{{- if ge $limit 1 -}}
{{- $pages = $pages | first $limit -}}
{{- end -}}
{
  "@context": "https://www.w3.org/ns/activitystreams",
  "id": "{{ $.Site.BaseURL }}outbox",
  "summary": "{{$.Site.Author.name}} - {{$.Site.Title}}",
  "type": "OrderedCollection",
  {{ $all := where $pages ".Draft" "!=" true }}
  "totalItems": {{(len $all)}},
  "orderedItems": [
  {{ range $index, $element := $all  }}
    {{- if ne $index 0 }}, {{ end }}
    {
      "@context": "https://www.w3.org/ns/activitystreams",
      "id": "{{.Permalink}}-create",
      "type": "Create",
      "actor": "{{ .Site.BaseURL }}{{ site.Params.apUser | lower}}",
      "object": {
        "id": "{{ .Permalink }}",
        "type": "Note",
        "content": {{ printf "\"" | safeHTML }}<b>{{.Title}}</b>{{ if .Summary }}<br>{{ replace (replace .Summary "\n" "<br>") "\r" "" }}{{ end }}<br><br>Read more here:<br><a href='{{.Permalink}}'>{{.Permalink}}</a>{{ printf "\"" | safeHTML }},
        "url": "{{.Permalink}}",
        "attributedTo": "{{ .Site.BaseURL }}{{ site.Params.apUser | lower}}",
        "to": "https://www.w3.org/ns/activitystreams#Public",
        {{ if .Site.Params.postHashtags }}
        "tag": [
          {{ range $indexTags, $elementTag := .Site.Params.postHashtags }}
          {{ if ne $indexTags 0 }}, {{ end }}
          {
            "type": "Hashtag",
            "href": "https://qoto.org/tags/{{ $elementTag }}",
            "name": "#{{ $elementTag }}"
          }
          {{ end }}
          ],
        {{ end }}
        "published": {{ dateFormat "2006-01-02T15:04:05-07:00" .Date | jsonify }}
      }
    }
  {{end}}
  ]
}
